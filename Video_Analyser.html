<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>豆包调试版</title>
    
    <!-- 1. 引入调试工具 (vConsole)，方便查看具体报错 -->
    <script src="https://cdn.bootcdn.net/ajax/libs/vConsole/3.15.1/vconsole.min.js"></script>
    <script>var vConsole = new window.VConsole();</script>

    <!-- 2. 尝试加载 SDK (增加多个备用节点) -->
    <script id="rtc-sdk" src="https://registry.npmmirror.com/@volcengine/rtc-sdk/4.45.0/files/dist/index.js" 
            onerror="console.error('阿里镜像加载失败'); loadNext()"></script>

    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; color: white; overflow: hidden; font-family: sans-serif; }
        #local-video { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; z-index: 1; }
        .bottom-overlay { position: absolute; bottom: 80px; left: 0; width: 100%; padding: 0 25px; box-sizing: border-box; z-index: 10; }
        .ai-message { font-size: 24px; text-shadow: 0 2px 8px rgba(0,0,0,0.8); }
        #start-mask { position: fixed; inset: 0; background: #000; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .start-btn { background: #7d60f5; color: white; border: none; padding: 16px 50px; border-radius: 35px; font-size: 18px; font-weight: bold; margin-bottom: 20px; }
        #diag-box { font-size: 12px; color: #aaa; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; margin: 0 20px; }
    </style>
</head>
<body>
    <video id="local-video" autoplay playsinline muted></video>
    
    <div class="bottom-overlay">
        <div class="ai-message"><span id="ai-text">等待连接...</span></div>
    </div>

    <div id="start-mask">
        <button class="start-btn" onclick="initCall()">开始通话</button>
        <div id="diag-box">
            <div>协议: <span id="diag-protocol">...</span></div>
            <div>SDK状态: <span id="diag-sdk">正在检测...</span></div>
            <div id="diag-err" style="color: #ff4d4f; margin-top: 5px;"></div>
        </div>
    </div>

    <script>
        // 自动诊断逻辑
        window.onload = function() {
            document.getElementById('diag-protocol').innerText = location.protocol;
            if (location.protocol !== 'https:') {
                document.getElementById('diag-err').innerText = "⚠️ 警告：必须使用 HTTPS 访问才能开启摄像头！";
            }
            checkSDKStatus();
        };

        function checkSDKStatus() {
            const sdk = window.VolcEngineRTC || window.VERTC;
            const sdkSpan = document.getElementById('diag-sdk');
            if (sdk) {
                sdkSpan.innerText = "✅ 已就绪 (v" + (sdk.VERSION || '4.x') + ")";
                sdkSpan.style.color = "#52c41a";
                return sdk;
            } else {
                sdkSpan.innerText = "❌ 尚未加载";
                return null;
            }
        }

        function loadNext() {
            console.log("尝试备用节点...");
            var s = document.createElement('script');
            s.src = "https://unpkg.com/@volcengine/rtc-sdk@4.45.0/dist/index.js";
            s.onerror = function() { document.getElementById('diag-err').innerText = "所有插件节点均加载失败，请检查手机是否开启了内容过滤或防火墙。"; };
            document.head.appendChild(s);
        }

        async function initCall() {
            const VolcSDK = checkSDKStatus();
            if (!VolcSDK) {
                alert("插件未加载，请点击右下角 vConsole 查看 Log 报错");
                return;
            }
            // ... (其余初始化逻辑保持不变)
            document.getElementById('start-mask').style.display = 'none';
            try {
                const engine = VolcSDK.createEngine("694e815bd68e9101747f2d3b");
                const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                document.getElementById('local-video').srcObject = stream;
                await engine.joinRoom("001694e815bd68e9101747f2d3bRADHACIF1oVOaVbAV2kEAHp3ZncKAG1hcmNlbF8wMDEGAAAAVsBXaQEAVsBXaQIAVsBXaQMAVsBXaQQAVsBXaQUAVsBXaSAAI2GnIyGyFhSffyVHHr+SEoKL6rpC+uDe+k621Fvl964=", "zwfw", { userId: "marcel_001" });
                await engine.publishStream(VolcSDK.MediaType.AUDIO_AND_VIDEO);
                document.getElementById('ai-text').innerText = "已就绪";
            } catch (e) {
                alert("错误: " + e.message);
            }
        }
    </script>
</body>
</html>
